## JSON Web Token

JWT — это лишь строка в следующем формате 

###### header.payload.signature

#### Принцип работы

![alt text](Schema)

Получив JWT от пользователя, приложение самостоятельно вычислит значение подписи и сравнит его с тем значением, которое было передано в токене. Если эти значения не совпадут, значит, токен был модифицирован или сгенерирован недоверенной стороной, и принимать такой токен и доверять ему приложение не будет.

#### Структура JWT

JWT состоит из трех частей: заголовок **header**, полезные данные **payload** и подпись **signature**.

###### header
   
    { 
        "alg": "HS256", 
        "typ": "JWT"
    }
    
###### payload
   
    { 
        "userId": "b08f86af-35da-48f2-8fab-cef3904660bd",
        "ip": "176.50.104.57",
        "exp": 1605874010
    }
    
###### signature
   
Подпись вычисляется с использование следующего псевдо-кода:


    const SECRET_KEY = 'cAtwa1kkEy'
    const unsignedToken = base64urlEncode(header) + '.' + base64urlEncode(payload)
    const signature = HMAC-SHA256(unsignedToken, SECRET_KEY)

Алгоритм base64url кодирует хедер и payload, созданные на 1 и 2 шаге. Алгоритм соединяет закодированные строки через точку. Затем полученная строка хешируется алгоритмом, заданным в хедере на основе нашего секретного ключа.


    header eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9
    payload eyJ1c2VySWQiOiJiMDhmODZhZi0zNWRhLTQ4ZjItOGZhYi1jZWYzOTA0NjYwYmQifQ
    signature -xN_h82PHVTCMA9vdoHrcZxH-x5mb11y1537t3rGzcM


>Поскольку JWT только лишь закодирована и подписана, и поскольку JWT не зашифрована, JWT не гарантирует никакой безопасности для чувствительных (sensitive) данных.

Преимущества JWT
Преимущества использования JWT в сравнении с классической схемой аутентификации, использующей сессии.

Во-первых, подход с использованием токенов позволяет не хранить информацию обо всех выданных токенах, как при классической схеме. Когда пользователь обращается к приложению, он передает ему свой токен. Приложению остается только проверить подпись и извлечь необходимые поля из полезной нагрузки.

Во-вторых, приложению вообще не обязательно заниматься выдачей и валидацией токенов самостоятельно, зачастую для этих целей используется отдельный сервис аутентификации.

В-третьих, при использовании отдельного сервиса аутентификации становится возможным организовать единую точку входа в различные сервисы с одними и теми же учетными данными. Единожды пройдя процедуру аутентификации, пользователь сможет получить доступ со своим токеном к тем ресурсам, которые доверяют этому сервису аутентификации.

В-четвертых, как было указано ранее, приложение может хранить в части полезной нагрузки практически любые данные, что при грамотной архитектуре приложения может существенно увеличить производительность.

#### Рекомендации по безопасности

Итак, для безопасного использования JWT следует:

* использовать защищенное соединение при передаче токенов;
* не передавать в токенах чувствительные пользовательские данные;
* ограничить время жизни JWT и использовать механизм refresh tokens;
* использовать ключевые фразы большой длины;
* обеспечить периодическую смену ключевой фразы;
* вести на стороне приложения белый список разрешенных алгоритмов подписи;
* в идеальном случае работать строго с одним алгоритмом подписи;
* выбирать хорошо известные и проверенные библиотеки для работы с JWT;
* всегда валидировать и санитизировать полученные от пользователя данные.

источники:
https://habr.com/ru/post/340146/
https://cyberpolygon.com/ru/materials/security-of-json-web-tokens-jwt/